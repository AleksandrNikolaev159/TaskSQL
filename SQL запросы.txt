
—оздание таблиц	Ќаполнение таблиц
CREATE TABLE devices(
device_id INTEGER NOT NULL,
device_type_id INTEGER,
parent_device_id INTEGER,
device_name VARCHAR,
setup_date DATE,
warehouse_id INTEGER)
PRIMARY KEY (device_id),
FOREIGN KEY (device_type_id) REFERENCES device_types (device_type_id),
FOREIGN KEY (warehouse_id) REFERENCES warehouses (warehouse_id );

	INSERT  INTO devices
VALUES(123,15,NULL,Т коммутатор D-Link на ленина, 1Т,Т01.02.2018Т),(ЕЕЕЕ)ЕЕ.;

CREATE TABLE device_types(
device_type_id INTEGER NOT NULL,
device_class_id INTEGER,
device_type_name VARCHAR,
device_cost INTEGER),
PRIMARY KEY (device_type_id),
FOREIGN KEY (device_class_id) REFERENCES device_classes (device_class_id);

	INSERT  INTO device_types
VALUES(15,7,NULL,Т коммутатор D-LinkТ,10200),(ЕЕЕЕ)ЕЕ.;


CREATE TABLE warehouses(
warehouse_id INTEGER NOT NULL,
warehouse_name VARCHAR),
PRIMARY KEY (warehouse_id);
	INSERT  INTO warehouses
VALUES(22,Т ленина, 1Т),(ЕЕЕЕ)ЕЕ.;

CREATE TABLE device_classes(
device_class_id INTEGER NOT NULL,
device_class_name VARCHAR),
PRIMARY KEY (device_class_id);

	INSERT  INTO device_classes
VALUES(7,Т коммутаторТ),(ЕЕЕЕ)ЕЕ.;
1) ¬ывести оборудование, которое поставлено до 01.09.2018
device_id	device_name	setup_date

SELECT device_id,device_name,setup_date 
FROM devices
WHERE setup_date <'01.09.2018'

2) ¬ывести все маршрутизаторы, сто€щие на сети.
device_type_name	device_name	device_cost	setup_date	warehouse_name
SELECT device_type_name,device_name,device_cost,setup_date,warehouse_name
FROM devices d
JOIN device_types dt
ON dt.device_type_id=d.device_type_id
JOIN warehouses w
ON  w.warehouse_id=d.warehouse_id
WHERE device_type_name LIKE 'маршрутизатор%'
3) ¬ывести устройства из класса "ћаршрутизатор", сто€щие на складе "ленина, 1"
device_id	device_name
SELECT d.device_id,d.device_name
FROM devices d
JOIN warehouses w 
ON d.warehouse_id=w.warehouse_id
WHERE w.warehouse_name='ленина, 1'
4) ѕодсчитать общую стоимость оборудовани€, сто€щего на сети.
SELECT SUM(device_cost) AS SUM
FROM device_types dt
JOIN devices d
ON d.device_type_id=dt.device_type_id
5) –ассчитать стоимость всего оборудовани€ на сети в разрезе классов
device_class_name	ќбща€ стоимость
SELECT dc.device_class_name,SUM(device_cost) AS ќбща€_стоимость
FROM device_types dt
JOIN device_classes dc
ON dc.device_class_id=dt.device_class_id
JOIN devices d
ON d.device_type_id=dt.device_type_id
GROUP BY device_class_name
6) ¬ывести иерархическую структуру устройств
device_name	LEVEL
SELECT d.device_name,
CASE 
WHEN (d.parent_device_id is null)
THEN 1
WHEN (d.parent_device_id >ANY(SELECT device_id FROM devices) )
THEN 3
ELSE 2
END device_level
FROM devices d 
7)¬ывести склады, которые были пустыми до 01.06.2018
warehouse_id	warehouse_name
SELECT w.warehouse_id,w.warehouse_name
FROM warehouses w
JOIN devices d
ON d.warehouse_id=w.warehouse_id
WHERE d.setup_date> '01.06.2018'
8)¬ывести устройства в формате
device_id	device_name	setup_date	Is_kmu
поле Is_kmu имеет значение 1 если устройство из класса коммутатор, иначе 0
SELECT d.device_id,d.device_name,d.setup_date,
CASE 
WHEN dc.device_class_name='коммутатор' 
THEN 1
ELSE 0
END Is_kmu
FROM device_classes dc
JOIN device_types dt
ON dt.device_class_id=dc.device_class_id
JOIN devices d
ON d.device_type_id=dt.device_type_id

